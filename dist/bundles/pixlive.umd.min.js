!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("ionic-angular"),require("rxjs/BehaviorSubject"),require("rxjs/Subject")):"function"==typeof define&&define.amd?define(["exports","@angular/core","ionic-angular","rxjs/BehaviorSubject","rxjs/Subject"],t):t(e.pixlive=e.pixlive||{},e.ng.core,e.ionicangular,e.Rx,e.Rx)}(this,function(e,t,n,o,i){"use strict";var r=function(){function e(e,t,n,o){this.platform=e,this.el=t,this.renderer=n,this.viewCtrl=o}return e.prototype.initArViewLifeCycle=function(){var e=this;this.viewCtrl.willEnter.subscribe(function(){e.arView&&(e.arView.beforeEnter(),e.onOrientationChange())}),this.viewCtrl.didEnter.subscribe(function(){e.arView&&e.arView.afterEnter(),e.fakeCamera&&e.renderer.setElementStyle(e.fakeCamera,"display","block")}),this.viewCtrl.willLeave.subscribe(function(){e.arView&&e.arView.beforeLeave(),e.fakeCamera&&e.renderer.setElementStyle(e.fakeCamera,"display","none")}),this.viewCtrl.didLeave.subscribe(function(){e.arView&&e.arView.afterLeave()})},e.prototype.onOrientationChange=function(){var e=this;setTimeout(function(){var t=e.el.nativeElement.getBoundingClientRect();e.arView.resize(t.left,t.top,t.width,t.height)},300)},e.prototype.ngOnInit=function(){var e=this;this.renderer.setElementStyle(this.el.nativeElement,"display","inline-block"),this.initArViewLifeCycle(),this.platform.ready().then(function(){setTimeout(function(){var t=e.el.nativeElement.getBoundingClientRect();if(window.cordova)e.arView=window.cordova.plugins.PixLive.createARView(t.left,t.top,t.width,t.height),window.addEventListener("orientationchange",function(){return e.onOrientationChange()},!1);else{var n=document.createElement("DIV");document.body.appendChild(n),e.renderer.setElementStyle(n,"position","fixed"),e.renderer.setElementStyle(n,"background-color","gray"),e.renderer.setElementStyle(n,"left",t.left+"px"),e.renderer.setElementStyle(n,"top",t.top+"px"),e.renderer.setElementStyle(n,"width",t.width+"px"),e.renderer.setElementStyle(n,"height",t.height+"px"),e.fakeCamera=n}},300)});for(var t=this.el.nativeElement.parentElement;t;)this.renderer.setElementStyle(t,"background-color","transparent"),t=t.parentElement},e.prototype.setTouchEnabled=function(e){e?this.arView.enableTouch():this.arView.disableTouch()},e.decorators=[{type:t.Directive,args:[{selector:"pixlive-camera-view"}]}],e.ctorParameters=function(){return[{type:n.Platform},{type:t.ElementRef},{type:t.Renderer},{type:n.ViewController}]},e}(),a=function(){function e(e,t){this.ngZone=e,this.platform=t,this.synchronizationProgress=new o.BehaviorSubject(101),this.annotationPresence=new i.Subject,this.eventFromContent=new i.Subject,this.enterContext=new i.Subject,this.exitContext=new i.Subject,this.qrCodeSynchronization=new i.Subject,this.codeRecognition=new i.Subject}return e.prototype.init=function(e){var t=this;this.platform.ready().then(function(){window.cordova&&(e&&window.cordova.plugins.PixLive.setNotificationsSupport(!0,e),window.cordova.plugins.PixLive.onEventReceived=function(e){if(console.log("PixLive new event: "+JSON.stringify(e)),"presentAnnotations"===e.type)t.ngZone.run(function(){t.annotationPresence.next(!0)});else if("hideAnnotations"===e.type)t.ngZone.run(function(){t.annotationPresence.next(!1)});else if("eventFromContent"===e.type)t.ngZone.run(function(){var n=new s;n.name=e.eventName,n.params=e.eventParams,t.eventFromContent.next(n)});else if("enterContext"===e.type)t.enterContext.next(e.context);else if("exitContext"===e.type)t.exitContext.next(e.context);else if("syncProgress"===e.type)t.synchronizationProgress.next(parseInt(""+100*e.progress));else if("codeRecognize"===e.type){var n=e.code;if(0===n.indexOf("pixliveplayer/")){var o=n.substring(14);t.qrCodeSynchronization.next(o)}else t.codeRecognition.next(n)}})})},e.prototype.getSynchronizationProgress=function(){return this.synchronizationProgress.asObservable()},e.prototype.getAnnotationPresenceObservable=function(){return this.annotationPresence.asObservable()},e.prototype.getEventFromContentObservable=function(){return this.eventFromContent.asObservable()},e.prototype.getEnterContextObservable=function(){return this.enterContext.asObservable()},e.prototype.getExitContextObservable=function(){return this.exitContext.asObservable()},e.prototype.getCodeRecognition=function(){return this.codeRecognition.asObservable()},e.prototype.getQrCodeSynchronizationRequest=function(){return this.qrCodeSynchronization.asObservable()},e.prototype.sync=function(e){var t=this;console.log("Synchronization with tags: "+JSON.stringify(e)),this.synchronizationProgress.next(0),this.platform.ready().then(function(){window.cordova?window.cordova.plugins.PixLive.synchronize(e,function(e){t.ngZone.run(function(){t.synchronizationProgress.next(100)})},function(e){t.ngZone.run(function(){t.synchronizationProgress.next(102)})}):setTimeout(function(){t.synchronizationProgress.next(25),setTimeout(function(){t.synchronizationProgress.next(50),setTimeout(function(){t.synchronizationProgress.next(75),setTimeout(function(){t.synchronizationProgress.next(103)},500)},500)},500)},500)})},e.prototype.getNearbyGpsPoints=function(e,t){var n=this;return new Promise(function(o,i){window.cordova?window.cordova.plugins.PixLive.getNearbyGPSPoints(e,t,function(e){n.ngZone.run(function(){o(e)})},function(){i("getNearbyGpsPoints failed")}):i("getNearbyGpsPoints failed: no cordova plugin")})},e.prototype.getGpsPointsInBoundingBox=function(e,t,n,o){return new Promise(function(i,r){window.cordova?window.cordova.plugins.PixLive.getGPSPointsInBoundingBox(e,t,n,o,function(e){i(e)},function(){r("Error")}):r("No cordova plugin")})},e.prototype.getContext=function(e){var t=this;return new Promise(function(n,o){window.cordova?window.cordova.plugins.PixLive.getContext(e,function(e){t.ngZone.run(function(){n(e)})},function(){o("getContext failed")}):o("getContext failed: no cordova plugin")})},e.prototype.activate=function(e){this.getContext(e).then(function(e){return e.activate()})},e.prototype.computeDistanceBetweenGPSPoints=function(e,t,n,o){var i=this;return new Promise(function(r,a){window.cordova?window.cordova.plugins.PixLive.computeDistanceBetweenGPSPoints(e,t,n,o,function(e){i.ngZone.run(function(){r(e)})},function(){a("computeDistanceBetweenGPSPoints failed")}):a("computeDistanceBetweenGPSPoints failed: no cordova plugin")})},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:t.NgZone},{type:n.Platform}]},e}(),s=function(){return function(){}}(),c=function(){function e(e){this.pixliveService=e}return e.prototype.ngOnInit=function(){var e=this;this.pixliveService.getAnnotationPresenceObservable().subscribe(function(t){return e.cameraView.setTouchEnabled(t)})},e.prototype.setClickable=function(e){this.cameraView.setTouchEnabled(e)},e.decorators=[{type:t.Component,args:[{selector:"pixlive",template:'<pixlive-camera-view style="width: 100%; height: 100%;"></pixlive-camera-view>'}]}],e.ctorParameters=function(){return[{type:a}]},e.propDecorators={cameraView:[{type:t.ViewChild,args:[r]}]},e}(),u=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{declarations:[c,r],exports:[c],providers:[a]}]}],e.ctorParameters=function(){return[]},e}();e.PixliveModule=u,e.PixliveComponent=c,e.PixliveService=a,Object.defineProperty(e,"__esModule",{value:!0})});
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@angular/core"),require("ionic-angular"),require("rxjs/BehaviorSubject"),require("rxjs/Subject")):"function"==typeof define&&define.amd?define(["exports","@angular/core","ionic-angular","rxjs/BehaviorSubject","rxjs/Subject"],n):n(e.pixlive=e.pixlive||{},e.ng.core,e.ionicangular,e.Rx,e.Rx)}(this,function(e,n,t,o,i){"use strict";var r=function(){function e(e,n,t,o){this.platform=e,this.el=n,this.renderer=t,this.viewCtrl=o}return e.prototype.initArViewLifeCycle=function(){var e=this;this.viewCtrl.willEnter.subscribe(function(){e.arView&&(e.arView.beforeEnter(),e.onOrientationChange())}),this.viewCtrl.didEnter.subscribe(function(){e.arView&&e.arView.afterEnter(),e.fakeCamera&&e.renderer.setElementStyle(e.fakeCamera,"display","block")}),this.viewCtrl.willLeave.subscribe(function(){e.arView&&e.arView.beforeLeave(),e.fakeCamera&&e.renderer.setElementStyle(e.fakeCamera,"display","none")}),this.viewCtrl.didLeave.subscribe(function(){e.arView&&e.arView.afterLeave()})},e.prototype.onOrientationChange=function(){var e=this;setTimeout(function(){var n=e.el.nativeElement.getBoundingClientRect();e.arView.resize(n.left,n.top,n.width,n.height)},300)},e.prototype.ngOnInit=function(){var e=this;this.renderer.setElementStyle(this.el.nativeElement,"display","inline-block"),this.initArViewLifeCycle(),this.platform.ready().then(function(){setTimeout(function(){var n=e.el.nativeElement.getBoundingClientRect();if(window.cordova)e.arView=window.cordova.plugins.PixLive.createARView(n.left,n.top,n.width,n.height),window.addEventListener("orientationchange",function(){return e.onOrientationChange()},!1);else{var t=document.createElement("DIV");document.body.appendChild(t),e.renderer.setElementStyle(t,"position","fixed"),e.renderer.setElementStyle(t,"background-color","gray"),e.renderer.setElementStyle(t,"left",n.left+"px"),e.renderer.setElementStyle(t,"top",n.top+"px"),e.renderer.setElementStyle(t,"width",n.width+"px"),e.renderer.setElementStyle(t,"height",n.height+"px"),e.fakeCamera=t}},300)});for(var n=this.el.nativeElement.parentElement;n;)this.renderer.setElementStyle(n,"background-color","transparent"),n=n.parentElement},e.prototype.setTouchEnabled=function(e){e?this.arView.enableTouch():this.arView.disableTouch()},e.decorators=[{type:n.Directive,args:[{selector:"pixlive-camera-view"}]}],e.ctorParameters=function(){return[{type:t.Platform},{type:n.ElementRef},{type:n.Renderer},{type:t.ViewController}]},e}(),a=function(){function e(e,n){this.ngZone=e,this.platform=n,this.synchronizationProgress=new o.BehaviorSubject(101),this.annotationPresence=new i.Subject,this.eventFromContent=new i.Subject,this.enterContext=new i.Subject,this.qrCodeSynchronization=new i.Subject,this.codeRecognition=new i.Subject}return e.prototype.init=function(e){var n=this;this.platform.ready().then(function(){window.cordova&&(e&&window.cordova.plugins.PixLive.setNotificationsSupport(!0,e),window.cordova.plugins.PixLive.onEventReceived=function(e){if(console.log("PixLive new event: "+JSON.stringify(e)),"presentAnnotations"===e.type)n.ngZone.run(function(){n.annotationPresence.next(!0)});else if("hideAnnotations"===e.type)n.ngZone.run(function(){n.annotationPresence.next(!1)});else if("eventFromContent"===e.type)n.ngZone.run(function(){var t=new s;t.name=e.eventName,t.params=e.eventParams,n.eventFromContent.next(t)});else if("enterContext"===e.type)n.enterContext.next(e.context);else if("syncProgress"===e.type)n.synchronizationProgress.next(parseInt(""+100*e.progress));else if("codeRecognize"===e.type){var t=e.code;if(0===t.indexOf("pixliveplayer/")){var o=t.substring(14);n.qrCodeSynchronization.next(o)}else n.codeRecognition.next(t)}})})},e.prototype.getSynchronizationProgress=function(){return this.synchronizationProgress.asObservable()},e.prototype.getAnnotationPresenceObservable=function(){return this.annotationPresence.asObservable()},e.prototype.getEventFromContentObservable=function(){return this.eventFromContent.asObservable()},e.prototype.getEnterContextObservable=function(){return this.enterContext.asObservable()},e.prototype.getCodeRecognition=function(){return this.codeRecognition.asObservable()},e.prototype.getQrCodeSynchronizationRequest=function(){return this.qrCodeSynchronization.asObservable()},e.prototype.sync=function(e){var n=this;console.log("Synchronization with tags: "+JSON.stringify(e)),this.synchronizationProgress.next(0),this.platform.ready().then(function(){window.cordova?window.cordova.plugins.PixLive.synchronize(e,function(e){n.ngZone.run(function(){n.synchronizationProgress.next(100)})},function(e){n.ngZone.run(function(){n.synchronizationProgress.next(102)})}):setTimeout(function(){n.synchronizationProgress.next(25),setTimeout(function(){n.synchronizationProgress.next(50),setTimeout(function(){n.synchronizationProgress.next(75),setTimeout(function(){n.synchronizationProgress.next(103)},500)},500)},500)},500)})},e.prototype.getNearbyGpsPoints=function(e,n){var t=this;return new Promise(function(o,i){window.cordova?window.cordova.plugins.PixLive.getNearbyGPSPoints(e,n,function(e){t.ngZone.run(function(){o(e)})},function(){i("getNearbyGpsPoints failed")}):i("getNearbyGpsPoints failed: no cordova plugin")})},e.prototype.getGpsPointsInBoundingBox=function(e,n,t,o){return new Promise(function(i,r){window.cordova?window.cordova.plugins.PixLive.getGPSPointsInBoundingBox(e,n,t,o,function(e){i(e)},function(){r("Error")}):r("No cordova plugin")})},e.prototype.getContext=function(e){var n=this;return new Promise(function(t,o){window.cordova?window.cordova.plugins.PixLive.getContext(e,function(e){n.ngZone.run(function(){t(e)})},function(){o("getContext failed")}):o("getContext failed: no cordova plugin")})},e.prototype.activate=function(e){this.getContext(e).then(function(e){return e.activate()})},e.prototype.computeDistanceBetweenGPSPoints=function(e,n,t,o){var i=this;return new Promise(function(r,a){window.cordova?window.cordova.plugins.PixLive.computeDistanceBetweenGPSPoints(e,n,t,o,function(e){i.ngZone.run(function(){r(e)})},function(){a("computeDistanceBetweenGPSPoints failed")}):a("computeDistanceBetweenGPSPoints failed: no cordova plugin")})},e.decorators=[{type:n.Injectable}],e.ctorParameters=function(){return[{type:n.NgZone},{type:t.Platform}]},e}(),s=function(){return function(){}}(),c=function(){function e(e){this.pixliveService=e}return e.prototype.ngOnInit=function(){var e=this;this.pixliveService.getAnnotationPresenceObservable().subscribe(function(n){return e.cameraView.setTouchEnabled(n)})},e.prototype.setClickable=function(e){this.cameraView.setTouchEnabled(e)},e.decorators=[{type:n.Component,args:[{selector:"pixlive",template:'<pixlive-camera-view style="width: 100%; height: 100%;"></pixlive-camera-view>'}]}],e.ctorParameters=function(){return[{type:a}]},e.propDecorators={cameraView:[{type:n.ViewChild,args:[r]}]},e}(),u=function(){function e(){}return e.decorators=[{type:n.NgModule,args:[{declarations:[c,r],exports:[c],providers:[a]}]}],e.ctorParameters=function(){return[]},e}();e.PixliveModule=u,e.PixliveComponent=c,e.PixliveService=a,Object.defineProperty(e,"__esModule",{value:!0})});